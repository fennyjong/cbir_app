<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin CBIR</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="wrapper">
        <aside class="sidebar" id="sidebar">
            <h2>Menu</h2>
            <ul>
                <li><a href="#" id="home-link"><i class="fas fa-home"></i> Beranda</a></li>
                <li><a href="#" id="dataset-link"><i class="fas fa-database"></i> Kelola Dataset</a></li>
                <li><a href="#" id="search-link"><i class="fas fa-search"></i> Pencarian Dataset</a></li>
            </ul>
        </aside>

        <main class="main-content" id="main-content">
            <header id="header">
                <div class="header-left">
                    <button class="hamburger" id="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Dashboard Admin CBIR</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name">Admin</span>
                    </div>
                    <a href="/logout" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </header>
            <div class="welcome-message" id="welcome-message">
                Selamat Datang Administrator
            </div>
            <div class="dashboard-card" id="content" style="display: none;"></div>
            <div class="credit">
                <p>&copy; 2024 Fenny Jong. All rights reserved.</p>
            </div>
        </main>
    </div>

    <div class="overlay" id="overlay"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const homeLink = document.getElementById('home-link');
            const datasetLink = document.getElementById('dataset-link');
            const searchLink = document.getElementById('search-link');
            const content = document.getElementById('content');
            const welcomeMessage = document.getElementById('welcome-message');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const header = document.getElementById('header');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const overlay = document.getElementById('overlay');

            let cropper;

            function showHome() {
                content.style.display = 'none';
                welcomeMessage.style.display = 'block';
            }

            function showDatasetManagement() {
                welcomeMessage.style.display = 'none';
                content.innerHTML = `
                    <h2>Penambahan Dataset</h2>
                    <form action="/upload" method="POST" enctype="multipart/form-data" id="upload-form">
                        <div class="form-grid">
                            <div>
                                <div class="form-group">
                                    <label for="image">Unggah Gambar</label>
                                    <input type="file" id="image-input" name="image" accept="image/*" required>
                                </div>
                                <div class="image-preview-container">
                                    <div class="image-preview">
                                        <img src="" alt="Pratinjau Gambar" id="image-preview">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="form-group">
                                    <label for="region">Daerah Asal</label>
                                    <select id="region" name="region" required>
                                        <option value="">Pilih Daerah Asal</option>
                                        <option value="Kalimantan">Kalimantan</option>
                                        <option value="Riau">Riau</option>
                                        <option value="Lombok">Lombok</option>
                                        <option value="lainnya">Lainnya</option>
                                    </select>
                                    <input type="text" id="custom-region" name="custom-region" placeholder="Masukkan Daerah Lain" style="display: none; width: 96%; padding: 0.75rem; border: 1px solid #ced4da; border-radius: 0.25rem;" />
                                </div>
                                <div class="form-group">
                                    <label for="fabric_name">Nama Kain</label>
                                    <select id="fabric_name" name="fabric_name" required>
                                        <option value="">Pilih Nama Kain</option>
                                        <option value="Batik">Batik</option>
                                        <option value="Songket">Songket</option>
                                        <option value="Tenun Ikat">Tenun Ikat</option>
                                        <option value="Ulos">Ulos</option>
                                        <option value="Sasirangan">Sasirangan</option>
                                        <option value="Tapis">Tapis</option>
                                        <option value="Gringsing">Gringsing</option>
                                        <option value="Endek">Endek</option>
                                        <option value="lainnya">Lainnya</option>
                                    </select>
                                    <input type="text" id="custom-nama" name="custom-nama" placeholder="Masukkan Nama Lain" style="display: none; width: 96%; padding: 0.75rem; border: 1px solid #ced4da; border-radius: 0.25rem;" />
                                </div>
                                <div class="form-group">
                                    <label>Penerapan Augmentasi:</label>
                                    <div class="augment-group">
                                        <input type="checkbox" id="augment1" name="augment1" value="rotate">
                                        <label for="augment1">Rotasi</label>
                                        <input type="checkbox" id="augment2" name="augment2" value="flip">
                                        <label for="augment2">Flip</label>
                                        <input type="checkbox" id="augment3" name="augment3" value="crop">
                                        <label for="augment3">Crop</label>
                                    </div>
                                </div>
                                <button type="submit" class="btn">Unggah Dataset</button>
                            </div>
                        </div>
                    </form>
                `;
                content.style.display = 'block';
                initializeDatasetManagement();
            }

            function showSearch() {
                welcomeMessage.style.display = 'none';
                content.innerHTML = `
                    <h2>Pencarian Dataset</h2>
                    <p>Silakan masukkan kriteria pencarian Anda di sini.</p>
                    <input type="text" placeholder="Kriteria pencarian" required>
                    <button>Cari</button>
                `;
                content.style.display = 'block';
            }

            function initializeDatasetManagement() {
                const imageInput = document.getElementById('image-input');
                const imagePreview = document.getElementById('image-preview');
                const regionSelect = document.getElementById('region');
                const customRegion = document.getElementById('custom-region');
                const fabricNameSelect = document.getElementById('fabric_name');
                const customNama = document.getElementById('custom-nama');

                imageInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreview.src = e.target.result;
                            initCropper();
                        };
                        reader.readAsDataURL(file);
                    }
                });

                regionSelect.addEventListener('change', function() {
                    customRegion.style.display = this.value === 'lainnya' ? 'block' : 'none';
                    customRegion.required = this.value === 'lainnya';
                });

                fabricNameSelect.addEventListener('change', function() {
                    customNama.style.display = this.value === 'lainnya' ? 'block' : 'none';
                    customNama.required = this.value === 'lainnya';
                });
            }

            function initCropper() {
                if (cropper) {
                    cropper.destroy();
                }
                const imagePreview = document.getElementById('image-preview');
                cropper = new Cropper(imagePreview, {
                    aspectRatio: 1,
                    viewMode: 1,
                    minCropBoxWidth: 225,
                    minCropBoxHeight: 225,
                    crop: function(event) {
                        if (event.detail.width < 225 || event.detail.height < 225) {
                            cropper.setCropBoxData({
                                width: Math.max(225, event.detail.width),
                                height: Math.max(225, event.detail.height)
                            });
                        }
                    }
                });
            }

            // Sidebar toggle functionality
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('hidden');
                mainContent.classList.toggle('full-width');
                header.classList.toggle('full-width');
                overlay.classList.toggle('active');
            });

            overlay.addEventListener('click', function() {
                sidebar.classList.add('hidden');
                mainContent.classList.add('full-width');
                header.classList.add('full-width');
                overlay.classList.remove('active');
            });

            // Menu item click handlers
            homeLink.addEventListener('click', showHome);
            datasetLink.addEventListener('click', showDatasetManagement);
            searchLink.addEventListener('click', showSearch);

            // Initial page load
            showHome();
        });
    </script>
</body>
</html>